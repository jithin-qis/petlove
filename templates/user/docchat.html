{%include 'user/header.html' %}


<style type="text/css">
.chat-popup {
  display: none;
  position: fixed;
  bottom: 0;
  right: 15px;
  border: 3px solid #f1f1f1;
  z-index: 9;
}
/* CSS talk bubble */
.talk-bubble {
	margin: 9px;
  display: inline-block;
  position: relative;
	width: 200px;
	height: auto;
	background-color: lightyellow;
}
.border{
  border: 8px solid #666;
}
.round{
  border-radius: 30px;
	-webkit-border-radius: 30px;
	-moz-border-radius: 30px;

}

/* Right triangle placed top left flush. */
.tri-right.border.left-top:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: -40px;
	right: auto;
  top: -8px;
	bottom: auto;
	border: 32px solid;
	border-color: #666 transparent transparent transparent;
}
.tri-right.left-top:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: -20px;
	right: auto;
  top: 0px;
	bottom: auto;
	border: 22px solid;
	border-color: lightyellow transparent transparent transparent;
}

/* Right triangle, left side slightly down */
.tri-right.border.left-in:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: -40px;
	right: auto;
  top: 30px;
	bottom: auto;
	border: 20px solid;
	border-color: #666 #666 transparent transparent;
}
.tri-right.left-in:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: -20px;
	right: auto;
  top: 38px;
	bottom: auto;
	border: 12px solid;
	border-color: lightyellow lightyellow transparent transparent;
}

/*Right triangle, placed bottom left side slightly in*/
.tri-right.border.btm-left:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
	left: -8px;
  right: auto;
  top: auto;
	bottom: -40px;
	border: 32px solid;
	border-color: transparent transparent transparent #666;
}
.tri-right.btm-left:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
	left: 0px;
  right: auto;
  top: auto;
	bottom: -20px;
	border: 22px solid;
	border-color: transparent transparent transparent lightyellow;
}

/*Right triangle, placed bottom left side slightly in*/
.tri-right.border.btm-left-in:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
	left: 30px;
  right: auto;
  top: auto;
	bottom: -40px;
	border: 20px solid;
	border-color: #666 transparent transparent #666;
}
.tri-right.btm-left-in:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
	left: 38px;
  right: auto;
  top: auto;
	bottom: -20px;
	border: 12px solid;
	border-color: lightyellow transparent transparent lightyellow;
}

/*Right triangle, placed bottom right side slightly in*/
.tri-right.border.btm-right-in:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: 30px;
	bottom: -40px;
	border: 20px solid;
	border-color: #666 #666 transparent transparent;
}
.tri-right.btm-right-in:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: 38px;
	bottom: -20px;
	border: 12px solid;
	border-color: lightyellow lightyellow transparent transparent;
}
/*
	left: -8px;
  right: auto;
  top: auto;
	bottom: -40px;
	border: 32px solid;
	border-color: transparent transparent transparent #666;
	left: 0px;
  right: auto;
  top: auto;
	bottom: -20px;
	border: 22px solid;
	border-color: transparent transparent transparent lightyellow;

/*Right triangle, placed bottom right side slightly in*/
.tri-right.border.btm-right:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: -8px;
	bottom: -40px;
	border: 20px solid;
	border-color: #666 #666 transparent transparent;
}
.tri-right.btm-right:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: 0px;
	bottom: -20px;
	border: 12px solid;
	border-color: lightyellow lightyellow transparent transparent;
}

/* Right triangle, right side slightly down*/
.tri-right.border.right-in:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: -40px;
  top: 30px;
	bottom: auto;
	border: 20px solid;
	border-color: #666 transparent transparent #666;
}
.tri-right.right-in:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: -20px;
  top: 38px;
	bottom: auto;
	border: 12px solid;
	border-color: lightyellow transparent transparent lightyellow;
}

/* Right triangle placed top right flush. */
.tri-right.border.right-top:before {
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: -40px;
  top: -8px;
	bottom: auto;
	border: 32px solid;
	border-color: #666 transparent transparent transparent;
}
.tri-right.right-top:after{
	content: ' ';
	position: absolute;
	width: 0;
	height: 0;
  left: auto;
	right: -20px;
  top: 0px;
	bottom: auto;
	border: 20px solid;
	border-color: lightyellow transparent transparent transparent;
}

/* talk bubble contents */
.talktext{
  padding: 1em;
	text-align: left;
  line-height: 1.5em;
}
.talktext p{
  /* remove webkit p margins */
  -webkit-margin-before: 0em;
  -webkit-margin-after: 0em;
}
</style>







<form method="POST" enctype="multipart/form-data" action="/showchat">

<section class="blog_w3ls py-5" id="why">
		<div class="container py-xl-5 py-lg-3">
			<div class="title-section mb-md-5 mb-4">
				<h6 class="w3ls-title-sub"></h6>
				<h3 class="w3ls-title text-uppercase text-bl font-weight-bold">Doctor</h3>
			</div>
			<div class="row">
				



{% for raw in chat %}
				<div class="col-lg-4 col-md-6">
					<div class="card border-0 med-blog">
						<div class="card-header p-0">
							<img class="card-img-bottom" style ="height:180px; width:100px;" src="static/uploads/{{raw[14]}}" alt="image">
						</div>
						<div class="card-body border border-top-0">
							<div class="mb-3">
								<!-- <h5 class="blog-title card-title m-0">{{raw[1]}}</h5> -->
								<div class="blog_w3icon">
									<span>
										Name:{{raw[2]}}</span>
										<br>
										Place : <span>{{raw[7]}}</span>
								</div>
							</div>
							<span>Phone :{{raw[9]}}</span>
							<br>
							<span>Email: {{raw[10]}}</span>
							<br><a href="/chat?to_id={{raw[10]}}" class="btn submit mt-4">Talk to me</a>
							<!-- <button type="submit" class="btn submit mt-4">Appointment</button> -->
							<!-- <a href="single.html" class="btn blog-btn mt-4">Read more</a> -->
						</div>
					</div>
				</div>

{% endfor %}
				



			</div>
		</div>
	</section>



<div class="chat-popup" id="myForm">
 
    <h1>Chat</h1>

    



<div id="chatarea" style="width:400px; height:400px; background-color:cyan;overflow:scroll;">
<!-- <div id="chatarea">  -->
<!-- <div class="talk-bubble tri-right left-top"> -->

	{% for raw  in messages %}
		{% if raw[1]==from_id %}
		<div class="talk-bubble tri-left round left-in" style="float:right; !important">
		  <div class="talktext" style="float:right; !important">
		    <p>{{raw[4]}}</p>
		  </div>
		</div>
		{% else %}
		<div class="talk-bubble tri-left round left-in">
		  <div class="talktext">
		    <p>{{raw[4]}}</p>
		  </div>
		</div>
		{% endif %}
	{% endfor %}
<!-- </div> -->
</div>
<br>
<div style="width:400px; height:100px;">
<textarea id="myTextarea" placeholder="type your message" style="width:400px; height:80px;" onkeypress="return runScript(event)"> </textarea>

</div>





    <!-- <button type="submit" class="btn">Send</button> -->
    <button type="button" class="btn cancel" onclick="closeForm()">Close</button>

</div>



<script type="text/javascript">
	function openForm() {
  document.getElementById("myForm").style.display = "block";
}

function closeForm() {
  document.getElementById("myForm").style.display = "none";
}
</script>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script type="text/javascript">
function runScript(e)
{
if(e.keyCode == 13)
{

  var textbox = document.getElementById("myTextarea").value;
  console.log(textbox)
  document.getElementById("myTextarea").value = ''

  document.getElementById("chatarea").innerHTML = document.getElementById("chatarea").innerHTML +"<div class='talk-bubble tri-left round left-in'><div class='talktext'><p>"+textbox+"</p></div></div>"
  $.post('/send1', {message: textbox}, function(response){
  
	console.log(response)
  

  });
 }
 return true;
}

//var myVar = setInterval(getnewmessage, 5000);
function getnewmessage() {
	var talking_to = "{{ talking_to }}"
	var from_id = "{{ from_id }}"
	console.log("get messgae ",talking_to, from_id)
  $.post('/getnewmessage',{"get_from": talking_to, "from_id":from_id}, function(response){
	console.log(response)
	if(response=="no_msg")
	{

	}
	else
	{
		document.getElementById("chatarea").innerHTML = document.getElementById("chatarea").innerHTML +"<div class='talk-bubble tri-left round left-in' style='float:right; !important'><div class='talktext' style='float:right; !important'><p>"+response+"</p></div></div>"
	}
  });
}

</script>
{% include 'user/footer.html'%}